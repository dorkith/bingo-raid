<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bingo Raid ‚Äî GitHub Pages</title>
  <style>
    :root {
      --bg:#0e1320;
      --card:#151c2b;
      --accent:#4dd2ff;
      --muted:#9ca8b8;
      --success:#3de364;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body {
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);
      color:#e8f0fa;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      min-height:100vh;
      padding:2rem;
      overflow-x:hidden;
    }
    h1{text-align:center;margin-bottom:.5rem;font-size:1.5rem}
    .wrapper{max-width:900px;width:100%}
    .card{
      background:var(--card);
      padding:1.5rem;
      border-radius:1rem;
      box-shadow:0 6px 20px rgba(0,0,0,0.4);
    }
    .controls{
      display:flex;flex-wrap:wrap;gap:.5rem;justify-content:center;margin-bottom:1rem;
    }
    input[type=text]{
      padding:.5rem .75rem;border-radius:.5rem;border:1px solid #333;
      background:#0c1322;color:#e8f0fa;
    }
    button{
      padding:.5rem 1rem;border-radius:.5rem;border:none;cursor:pointer;font-weight:600;
    }
    #genBtn{background:var(--accent);color:#04141f}
    .grid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:.75rem;
    }
    .cell{
      position:relative;
      padding:.75rem;
      border-radius:.5rem;
      min-height:90px;
      background:#1c2537;
      text-align:center;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:600;
      transition:background .2s, transform .3s;
    }
    .cell input{position:absolute;inset:0;opacity:0;cursor:pointer}
    .xmark{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      font-size:3rem;opacity:0;pointer-events:none;transition:opacity .2s;
    }
    .cell.checked{background:#0b0f18;filter:grayscale(50%)}
    .cell.checked .xmark{opacity:1}
    .line-complete{
      background:var(--success)!important;
      color:#04141f!important;
      transform:scale(1.05);
      animation:lineGlow 1s ease forwards;
    }
    @keyframes lineGlow {
      0% {box-shadow:0 0 0 rgba(0,0,0,0);}
      50% {box-shadow:0 0 25px 5px var(--success);}
      100% {box-shadow:0 0 0 rgba(0,0,0,0);}
    }
    .popup{
      position:fixed;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%) scale(0.8);
      background:var(--success);
      color:#04141f;
      padding:1rem 2rem;
      border-radius:1rem;
      font-size:1.5rem;
      font-weight:700;
      box-shadow:0 0 20px var(--success);
      opacity:0;
      pointer-events:none;
      z-index:9999;
      animation:popupFade 2s ease forwards;
    }
    @keyframes popupFade {
      0%{opacity:0;transform:translate(-50%,-50%) scale(0.7);}
      15%{opacity:1;transform:translate(-50%,-50%) scale(1);}
      85%{opacity:1;transform:translate(-50%,-50%) scale(1);}
      100%{opacity:0;transform:translate(-50%,-50%) scale(0.8);}
    }
    footer{
      margin-top:1rem;
      font-size:.85rem;
      color:var(--muted);
      text-align:center;
    }
    @media(max-width:640px){
      .grid{grid-template-columns:repeat(2,1fr)}
      .cell{min-height:110px}
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="card">
      <h1>Bingo du Raid ‚öîÔ∏è</h1>
      <div class="controls">
        <input id="pseudoInput" type="text" placeholder="Entre ton pseudo..." />
        <button id="genBtn">üé≤ G√©n√©rer ma grille</button>
      </div>
      <div id="grid" class="grid"></div>
      <footer>
        Grille unique par pseudo ‚Äî cases sauvegard√©es localement. <br>
        Partage ton lien : <code>?pseudo=TonPseudo</code>
      </footer>
    </div>
  </div>

  <script>
    const ITEMS=[
      "Mon ange","Atlance reprend l'aggro","Raxi reprend l'aggro","Mort a cause d'une charge du golem",
      "Se prend un souffle des chiens","Pull foireux","Strat beaucoup trop longue","SEXE",
      "P√©p√®re parle a la 3e personne","Ca demande un TP","Ca se trompe de chemin",
      "On ne tue pas les chiens en meme temps","Fail pull","Bodypull #groscul",
      "Se plaint des heals","Sleyzer voix un coffre et parle arabe",
      "Encore une ceinture hunt","On attend que le mob depop parce que les demos ont fait un max rand",
      "La carpette du raid meurt encore","Demande un robot repa"
    ];

    const COLS=4, ROWS=5;
    function xfnv1a(str){for(var i=0,h=2166136261>>>0;i<str.length;i++){h=Math.imul(h^str.charCodeAt(i),16777619);}return()=>{h+=0x6D2B79F5;var t=Math.imul(h^(h>>>15),1|h);t^=t+Math.imul(t^(t>>>7),61|t);return((t^(t>>>14))>>>0)/4294967296;};}
    function seededShuffle(array,seedStr){const rand=xfnv1a(seedStr);const a=array.slice();for(let i=a.length-1;i>0;i--){const r=Math.floor(rand()*(i+1));[a[i],a[r]]=[a[r],a[i]];}return a;}
    function storageKeyFor(pseudo){return 'bingo_'+pseudo.replace(/[^a-z0-9_-]/gi,'');}

    const gridEl=document.getElementById('grid');
    const pseudoInput=document.getElementById('pseudoInput');
    const genBtn=document.getElementById('genBtn');

    function buildGridFor(pseudo){
      if(!pseudo)return;
      const key=storageKeyFor(pseudo);
      const order=seededShuffle(ITEMS,pseudo);
      const cells=order.slice(0,ROWS*COLS);
      let state={checked:{}};
      try{const raw=localStorage.getItem(key);if(raw)state=JSON.parse(raw);}catch(e){}

      gridEl.innerHTML='';
      cells.forEach((text,idx)=>{
        const cell=document.createElement('div');
        cell.className='cell';
        cell.dataset.idx=idx;
        const cb=document.createElement('input');
        cb.type='checkbox';
        cb.checked=!!state.checked[idx];
        if(cb.checked)cell.classList.add('checked');
        const lbl=document.createElement('div');
        lbl.textContent=text;
        const x=document.createElement('div');
        x.className='xmark';
        x.textContent='‚úï';
        cb.addEventListener('change',()=>{
          if(cb.checked)cell.classList.add('checked');
          else cell.classList.remove('checked');
          state.checked[idx]=cb.checked;
          localStorage.setItem(key,JSON.stringify(state));
          checkLinesAndColumns();
        });
        cell.append(cb,lbl,x);
        gridEl.appendChild(cell);
      });

      const newUrl=new URL(window.location.href);
      newUrl.searchParams.set('pseudo',pseudo);
      window.history.replaceState({},'',newUrl);

      setTimeout(checkLinesAndColumns,200);
    }

    function getPseudoFromUrl(){
      const p=new URLSearchParams(window.location.search).get('pseudo');
      return p?decodeURIComponent(p):null;
    }

    function showPopup(msg){
      const pop=document.createElement('div');
      pop.className='popup';
      pop.textContent=msg;
      document.body.appendChild(pop);
      setTimeout(()=>pop.remove(),2000);
    }

    function checkLinesAndColumns(){
      const cells=[...document.querySelectorAll('.cell')];
      const matrix=[];
      for(let r=0;r<ROWS;r++)matrix.push(cells.slice(r*COLS,(r+1)*COLS));

      // V√©rifie chaque ligne
      matrix.forEach((row,r)=>{
        if(row.every(c=>c.classList.contains('checked')) && !row[0].classList.contains('line-complete')){
          row.forEach(c=>c.classList.add('line-complete'));
          showPopup(`‚úÖ Ligne ${r+1} valid√©e !`);
        }
      });

      // V√©rifie chaque colonne
      for(let c=0;c<COLS;c++){
        const col=matrix.map(r=>r[c]);
        if(col.every(cell=>cell.classList.contains('checked')) && !col[0].classList.contains('line-complete')){
          col.forEach(cell=>cell.classList.add('line-complete'));
          showPopup(`‚úÖ Colonne ${c+1} valid√©e !`);
        }
      }
    }

    genBtn.addEventListener('click',()=>{
      const p=(pseudoInput.value||'').trim();
      if(!p){showPopup('Entre un pseudo');return;}
      buildGridFor(p);
    });

    window.addEventListener('load',()=>{
      const u=getPseudoFromUrl();
      if(u){pseudoInput.value=u;buildGridFor(u);}
    });
  </script>
</body>
</html>
